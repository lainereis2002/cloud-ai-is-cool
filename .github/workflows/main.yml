name: CI - Build e Testes do FastAPI Backend

# Gatilho: Roda em todo Pull Request (PR) e Push nas branches principais
on:
  push:
    branches:
      - main
      - staging
  pull_request:
    branches:
      - main
      - staging

jobs:
  # ------------------------------------------------------------------
  # JOB: CI - Build e Teste de Qualidade
  # ------------------------------------------------------------------
  ci_build_and_test:
    name: âš™ï¸ Build e Teste
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout do CÃ³digo
        uses: actions/checkout@v4

      # --- Ambiente Python ---
      - name: ğŸ Configurar Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip' # Usa cache para dependÃªncias (acelera o processo)

      - name: ğŸ“¦ Instalar DependÃªncias (FastAPI)
        # Assume que o requirements.txt estÃ¡ na raiz
        run: pip install -r requirements.txt
        
      # --- Testes UnitÃ¡rios ---
      - name: ğŸ§ª Executar Testes UnitÃ¡rios (PLACEHOLDER)
        # ESTE Ã‰ O PASSO MAIS IMPORTANTE DO CI.
        # VocÃª deve instalar o 'pytest' no seu requirements.txt e ter testes.
        # run: pytest
        run: |
          echo "âš ï¸ ATENÃ‡ÃƒO: Substitua este 'echo' pelo comando real de teste (ex: 'pytest')."
          echo "Simulando sucesso dos testes por enquanto..."
          
      # --- VerificaÃ§Ã£o da Build Docker ---
      - name: ğŸ³ Verificar Build Docker
        # Garante que o Dockerfile funcione e a imagem seja criada.
        uses: docker/build-push-action@v5
        with:
          context: .
          push: false # Apenas constrÃ³i, nÃ£o envia para um registro
          tags: chatbot-ci-test # Tag de teste temporÃ¡ria
          
      - name: âœ… Sucesso do CI
        run: echo "IntegraÃ§Ã£o ContÃ­nua ConcluÃ­da com Sucesso!"